# ⚡ 性能配置指南

通过环境变量 `PRELOAD_NOTES_COUNT` 控制应用启动时预加载的笔记数量。

## 🎯 配置方法

```bash
# 设置预加载笔记数量
PRELOAD_NOTES_COUNT=20
```

**默认值**: 10个笔记

## 📊 推荐配置

| 部署平台 | 推荐值 | 原因 |
|----------|--------|------|
| **Vercel** | `5` | 单并发限制，保守加载 |
| **Cloudflare Pages** | `30` | 1000并发支持，可以激进加载 |
| **Docker 自建** | `15` | 根据服务器性能调整 |

## 🔧 配置方法

### 1. Vercel 部署
在 Vercel Dashboard 中设置环境变量：
1. 进入项目设置
2. 选择 "Environment Variables"
3. 添加 `PRELOAD_NOTES_COUNT=5`

### 2. Cloudflare Pages 部署
在 CF Pages Dashboard 中设置：
1. 进入项目设置
2. 选择 "Environment variables"
3. 添加 `PRELOAD_NOTES_COUNT=30`

### 3. Docker 部署
在 `docker-compose.yml` 中设置：
```yaml
services:
  matea:
    environment:
      - PRELOAD_NOTES_COUNT=15
```

### 4. 本地开发
在 `.env.local` 中设置：
```bash
PRELOAD_NOTES_COUNT=10
```

## 📈 性能影响

| 预加载数量 | 初始加载时间 | 用户体验 | 适用场景 |
|------------|--------------|----------|----------|
| **1-5** | 很快 (1-2秒) | 基础 | Vercel/低性能环境 |
| **10-20** | 中等 (2-4秒) | 良好 | 平衡配置 |
| **30-50** | 较慢 (4-8秒) | 优秀 | CF Pages/高性能环境 |
| **50+** | 慢 (8秒+) | 可能过度 | 特殊需求 |

## ⚠️ 注意事项

### 配置限制
- **最小值**: 1 (至少加载1个笔记)
- **最大值**: 100 (防止配置错误)
- **默认值**: 根据检测到的平台自动设置

### 智能警告
应用会自动检测配置是否合理：
```
⚠️ 预加载数量 50 可能过多，建议 20-30
```

### 性能监控
控制台会显示实际加载情况：
```
⚙️ 应用配置: 平台=cloudflare, 预加载=30个笔记
📊 Total notes: 45, Priority: 30, Others: 15
🎯 优化完成: 5 个API请求 instead of 45
```

## 🎛️ 高级配置

### 动态调整
可以根据用户的笔记数量动态调整：
- 笔记少于10个：全部预加载
- 笔记10-50个：预加载50%
- 笔记超过50个：使用配置值

### 用户习惯优化
未来可以考虑：
- 记录用户最常访问的笔记
- 优先预加载最近编辑的笔记
- 根据时间段调整预加载策略

## 🔍 故障排除

### 加载太慢
- 减少 `PRELOAD_NOTES_COUNT` 值
- 检查网络连接
- 确认数据库性能

### 内容显示不全
- 增加 `PRELOAD_NOTES_COUNT` 值
- 检查是否有缓存问题
- 确认环境变量设置正确

### 配置不生效
- 重启应用
- 检查环境变量拼写
- 确认部署平台的环境变量设置
